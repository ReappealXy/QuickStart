# QuickStart — 快速启动工具 架构设计

## 一、项目定位

**一句话概括：** 一个通过全局热键瞬间唤起的侧边栏效率工具，集「快速记录」「每日清单」「即时翻译」「AI 辅助」于一体，纯前端实现，数据以文件形式存储在本地，轻便、简洁、安全。

### 核心使用场景

| 场景 | 痛点 | QuickStart 方案 |
|------|------|----------------|
| 写代码时灵感闪现 | 要切窗口、开软件、找笔记 | `Ctrl+Shift+Q` 唤起侧边栏 → 输入 → `Ctrl+Enter` 保存，全程 < 3 秒 |
| 规划今日任务 | 打开各种 Todo 软件太重 | 切到「清单」Tab → 当天空白页 → 逐条添加，勾选完成 |
| 看文档遇到生词 | 要开浏览器、找翻译网站 | 切到「翻译」Tab → 输入即翻译 |
| 遇到问题想问 AI | 要打开浏览器、登录 AI 官网 | 切到「AI」Tab → 直接对话，即问即答，无需离开桌面 |

---

## 二、技术选型

### 方案：Electron + React + TypeScript（纯前端，零后端）

**为什么选 Electron：**

1. **纯前端开发** — 全部代码用 TypeScript 完成，无需学习 Rust/Go 等后端语言，维护成本最低
2. **Node.js 能力** — 通过 Node.js 的 `fs` 模块直接读写本地文件，实现数据存储
3. **系统级能力** — 全局热键 (`globalShortcut`)、系统托盘 (`Tray`)、剪贴板 (`clipboard`) 等 Electron 原生支持
4. **生态最成熟** — VS Code、Notion 桌面版、Obsidian 都基于 Electron，社区方案丰富
5. **数据透明** — 所有数据以 JSON/Markdown 文件保存在用户可见的文件夹中，不存在黑箱数据库

**体积与性能的权衡：**

| 维度 | Electron | 备注 |
|------|----------|------|
| 安装包体积 | ~80-100MB | 可通过 electron-builder 优化，用户只需安装一次 |
| 内存占用 | ~100-150MB | 对现代电脑可接受，Obsidian/VS Code 同等水平 |
| 启动速度 | ~1s (首次) / <0.5s (常驻托盘唤起) | 常驻托盘后唤起几乎无感 |

> 由于应用常驻系统托盘，用户日常使用时的体感是**热键瞬间唤起**，冷启动延迟只发生在开机后第一次打开。

### 技术栈总览

```
Electron 33+ (主进程 + 渲染进程，全 TypeScript)
│
├── 渲染进程 (UI 层)
│   ├── React 18 + TypeScript
│   ├── 构建工具：Vite (通过 electron-vite)
│   ├── UI 框架：Tailwind CSS + Radix UI
│   ├── 状态管理：Zustand
│   ├── Markdown：@uiw/react-md-editor 或 Milkdown
│   ├── 虚拟滚动：TanStack Virtual
│   ├── 动画：Framer Motion
│   └── 图标：Lucide Icons
│
├── 主进程 (系统能力层，依然是 TypeScript)
│   ├── 全局热键：Electron globalShortcut
│   ├── 系统托盘：Electron Tray
│   ├── 文件读写：Node.js fs/fs-extra
│   ├── 剪贴板：Electron clipboard
│   ├── HTTP 请求：Node.js fetch / undici (AI API)
│   └── 窗口管理：Electron BrowserWindow
│
└── 数据层 (本地文件)
    ├── JSON 文件 — 结构化数据 (笔记索引、清单、配置、工作区)
    ├── Markdown 文件 — 笔记正文 (可直接用任何编辑器打开)
    └── 附件文件夹 — 图片/文件原样保存
```

---

## 三、窗口形态 — 侧边栏式竖屏面板

### 3.1 设计理念

QuickStart 不是一个传统的居中弹窗，而是**贴在屏幕右侧的窄长面板**，类似浏览器侧边栏。
这种形态的好处是：

- **不遮挡主工作区** — 写代码时唤起，代码窗口依然可见
- **视觉轻量** — 窄面板比大弹窗压迫感更小，符合「快速工具」定位
- **内容纵向延伸** — 清单、对话、记录列表天然适合纵向滚动

### 3.2 窗口规格

```
屏幕
┌──────────────────────────────────┬──────────┐
│                                  │          │
│                                  │ Quick    │
│          用户的主工作区            │ Start    │
│         (代码编辑器等)            │          │
│                                  │ 380px    │
│                                  │          │
│                                  │          │
│                                  │          │
│                                  │          │
└──────────────────────────────────┴──────────┘
                                   ← 贴右侧 →
```

| 属性 | 值 |
|------|------|
| 宽度 | **380px** 固定 |
| 高度 | **屏幕工作区高度**（减去任务栏） |
| 位置 | 贴屏幕右侧边缘 |
| 边框 | 无边框 (frameless)，左侧有 1px 分隔线 |
| 层级 | 置顶 (alwaysOnTop)，可在设置中关闭 |
| 圆角 | 无圆角（贴边时圆角不自然），左上/左下可加微圆角 |

### 3.3 窗口行为

| 操作 | 行为 |
|------|------|
| `Ctrl+Shift+Q` | 从右侧滑入/滑出（带 200ms 滑动动画） |
| `Esc` | 滑出隐藏到托盘 |
| `Ctrl+Enter` | 提交/保存当前内容 |
| `Ctrl+1/2/3/4` | 快速切换 Tab |
| `Ctrl+,` | 打开设置 |
| 托盘图标双击 | 显示窗口 |
| 托盘右键 | 菜单：显示窗口 / 设置 / 退出 |

> 注意：「点击外部自动隐藏」在侧边栏模式下**默认关闭**，因为侧边栏本身就是作为常驻辅助面板存在的。可在设置中开启。

---

## 四、系统架构

### 4.1 整体架构图

```
┌───────────────────────────────────────────────────────┐
│                  Electron 主进程 (Main)                 │
│                    全部 TypeScript                      │
│  ┌───────────┐ ┌───────────┐ ┌──────────────────┐     │
│  │ 系统托盘   │ │ 全局热键   │ │ 文件服务 (fs)     │     │
│  │ Tray      │ │ Ctrl+Shift+Q │ │ · 读写 JSON      │     │
│  │           │ │ 自定义热键 │ │ · 读写 Markdown  │     │
│  │           │ │           │ │ · 管理附件        │     │
│  └───────────┘ └───────────┘ └──────────────────┘     │
│  ┌───────────┐ ┌──────────────────────────────────┐    │
│  │ 窗口管理   │ │ IPC 通信桥 (ipcMain)              │    │
│  │ 滑入/滑出  │ │ 渲染进程 ←→ 主进程的安全通道       │    │
│  │ 贴右侧    │ │                                  │    │
│  └───────────┘ └──────────────────────────────────┘    │
└────────────────────────┬──────────────────────────────┘
                         │ IPC
┌────────────────────────▼──────────────────────────────┐
│          Electron 渲染进程 (Renderer)                   │
│            React + TypeScript                          │
│            宽 380px，全屏高度                            │
│                                                        │
│  ┌──────────────────────────────────────────────────┐  │
│  │ 自定义标题栏 (拖拽区域 + 关闭/最小化)               │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │               Tab 导航栏 (图标模式)                │  │
│  │  [📝]   [✅]   [🌐]   [🤖]   [⚙️]               │  │
│  │  记录   清单   翻译   AI    设置                   │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │                                                  │  │
│  │           当前 Tab 的内容区域                      │  │
│  │           (纵向占满剩余高度)                       │  │
│  │                                                  │  │
│  └──────────────────────────────────────────────────┘  │
└────────────────────────┬──────────────────────────────┘
                         │ IPC 调用 fs
┌────────────────────────▼──────────────────────────────┐
│                    本地文件系统                          │
│                                                        │
│  用户可自由选择存储目录（默认 %APPDATA%/QuickStart/）     │
│                                                        │
│  QuickStart-Data/                                      │
│  ├── config.json              # 应用配置                │
│  ├── workspaces/              # 工作区                  │
│  │   └── default/                                      │
│  │       ├── index.json       # 笔记索引                │
│  │       ├── notes/           # 笔记 .md 文件           │
│  │       └── attachments/     # 附件                    │
│  ├── todos/                   # 每日清单                 │
│  │   ├── 2026-02-08.json                               │
│  │   ├── 2026-02-09.json                               │
│  │   └── ...                                           │
│  ├── translations.json        # 翻译历史                │
│  ├── statistics.json          # 统计数据                │
│  └── backups/                 # 自动备份                │
└────────────────────────────────────────────────────────┘
```

### 4.2 纯前端存储方案的优势

| 优势 | 说明 |
|------|------|
| **数据透明** | 用户可直接在文件管理器中浏览所有笔记 (.md 文件)，不被锁死在应用内 |
| **天然备份** | 文件夹可直接拖入网盘 (OneDrive/坚果云等) 实现同步备份 |
| **可迁移** | 换电脑时复制文件夹即可，无需导入导出 |
| **安全可控** | 无数据库黑箱，用户能确认数据完全在本地 |
| **可维护** | 即使应用崩溃，数据依然完好，用 Typora 等任何编辑器可打开 |

---

## 五、核心模块设计

### 5.1 Tab 导航

由于窗口宽度只有 380px，Tab 栏使用**图标 + 短文字**模式，节省横向空间：

```
┌────────────────────────────────────┐
│  📝记录  ✅清单  🌐翻译  🤖AI  ⚙️   │
└────────────────────────────────────┘
```

**快捷键：**

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+1` | 记录 Tab |
| `Ctrl+2` | 清单 Tab |
| `Ctrl+3` | 翻译 Tab |
| `Ctrl+4` | AI Tab |
| `Ctrl+,` | 设置 Tab |
| `Ctrl+Shift+Q` | 唤起/隐藏窗口 |
| `Esc` | 隐藏窗口 |

---

### 5.2 记录 Tab — 快速记录

```
┌──────────────────────────────────┐
│  📝记录  ✅清单  🌐翻译  🤖AI  ⚙️  │
│──────────────────────────────────│
│                                  │
│  工作区: [默认 ▼]     🔍          │
│                                  │
│  ┌──────────────────────────┐    │
│  │ 输入你的想法...           │    │
│  │ (支持 Markdown)          │    │
│  │                          │    │
│  │              [Ctrl+Enter]│    │
│  └──────────────────────────┘    │
│                                  │
│  ── 今天 ─────────────────────   │
│  📄 React 性能优化思路   14:32   │
│  📄 产品需求评审纪要     11:15   │
│                                  │
│  ── 昨天 ─────────────────────   │
│  📄 Rust 所有权笔记     22:08   │
│  📄 明天要买的东西       19:45   │
│                                  │
│                                  │
│ 📊 今日:5  累计:328  🔥连续7天   │
└──────────────────────────────────┘
```

**数据模型（JSON 文件）：**

`index.json` — 每个工作区一个索引文件：

```json
{
  "workspace": {
    "id": "default",
    "name": "默认",
    "color": "#6366f1",
    "icon": "inbox",
    "createdAt": "2026-02-08T10:00:00Z"
  },
  "notes": [
    {
      "id": "a1b2c3",
      "title": "React 性能优化思路",
      "preview": "今天研究了 React.memo 和 useMemo...",
      "tags": ["react", "性能"],
      "createdAt": "2026-02-08T14:32:00Z",
      "updatedAt": "2026-02-08T14:35:00Z",
      "isDeleted": false,
      "attachments": ["img_001.webp"]
    }
  ]
}
```

笔记正文 — 独立 Markdown 文件 `notes/2026-02-08_a1b2c3.md`

**关键特性：**

1. **草稿自动保存** — 输入框内容每 2 秒防抖写入 `draft.md`
2. **Markdown 实时预览** — 所见即所得模式
3. **图片粘贴** — `Ctrl+V` 粘贴 → 压缩 WebP → 存入 `attachments/`
4. **按日期分组** — 记录列表按「今天 / 昨天 / 更早」自动分组
5. **搜索** — 前端全文搜索
6. **虚拟滚动** — 万级记录使用 TanStack Virtual

---

### 5.3 清单 Tab — 每日待办 (新增)

这是你最关注的功能。参照日历清单的极简设计，一个 Tab 只做一件事：**当天的待办清单**。

#### UI 布局

```
┌──────────────────────────────────┐
│  📝记录  ✅清单  🌐翻译  🤖AI  ⚙️  │
│──────────────────────────────────│
│                                  │
│       ◀  2026年2月13日  ▶    ✓   │
│──────────────────────────────────│
│                                  │
│  ○ 1. 完成首页 UI 开发            │
│                                  │
│  ● 2. 修复登录页面 Bug    ── 划线 │
│                                  │
│  ○ 3. 写周报                     │
│                                  │
│  ○ 4. 回复邮件                   │
│                                  │
│                                  │
│                                  │
│                                  │
│                                  │
│                                  │
│                                  │
│                                  │
│──────────────────────────────────│
│  ┌──────────────────────────┐    │
│  │ 添加新事项...             │    │
│  └──────────────────────────┘    │
│  🎨  🔔  ⏰  🗑️                  │
│                                  │
│         3/4 已完成                │
└──────────────────────────────────┘
```

#### 交互说明

**顶部日期栏：**

| 元素 | 行为 |
|------|------|
| ◀ / ▶ 箭头 | 切换到前一天/后一天 |
| 日期文字 | 点击弹出日历选择器，可跳转到任意日期 |
| ✓ 按钮 | 标记当天清单为「已完成/已归档」 |

**清单项：**

| 操作 | 行为 |
|------|------|
| 点击圆圈 ○ | 勾选完成 → 变为 ●，文字加删除线 + 变灰 |
| 点击已完成 ● | 取消完成 → 恢复为 ○ |
| 点击文字 | 进入编辑模式，可修改内容 |
| 长按/右键 | 弹出菜单：编辑、删除、设置颜色、移到其他日期 |
| 拖拽 | 拖拽排序调整顺序 |
| `Enter` | 当前项确认 + 自动新增下一项（连续录入） |

**底部工具栏：**

| 图标 | 功能 |
|------|------|
| 🎨 调色板 | 设置当前选中项的文字颜色（预设 6-8 种颜色） |
| 🔔 提醒 | 为当前项设置提醒时间（系统通知） |
| ⏰ 时间 | 为当前项添加具体时间标记 |
| 🗑️ 删除 | 删除当前选中项（带 Undo） |

**底部统计：**

```
3/4 已完成
```

简洁显示今日完成进度。

#### 数据模型

每天一个独立 JSON 文件 — `todos/2026-02-13.json`：

```json
{
  "date": "2026-02-13",
  "archived": false,
  "items": [
    {
      "id": "t001",
      "content": "完成首页 UI 开发",
      "done": false,
      "color": null,
      "reminder": null,
      "time": null,
      "order": 0,
      "createdAt": "2026-02-13T09:00:00Z"
    },
    {
      "id": "t002",
      "content": "修复登录页面 Bug",
      "done": true,
      "color": "#ef4444",
      "reminder": null,
      "time": "14:00",
      "order": 1,
      "createdAt": "2026-02-13T09:01:00Z",
      "doneAt": "2026-02-13T14:30:00Z"
    },
    {
      "id": "t003",
      "content": "写周报",
      "done": false,
      "color": "#3b82f6",
      "reminder": "2026-02-13T17:00:00Z",
      "time": "17:00",
      "order": 2,
      "createdAt": "2026-02-13T09:02:00Z"
    }
  ]
}
```

**为什么每天一个文件：**

- 文件极小（一天几十条事项，不到 5KB）
- 天然按日期隔离，不需要复杂查询
- 切换日期时只加载对应文件，速度极快
- 文件名即日期，文件管理器中一目了然

---

### 5.4 翻译 Tab

```
┌──────────────────────────────────┐
│  📝记录  ✅清单  🌐翻译  🤖AI  ⚙️  │
│──────────────────────────────────│
│                                  │
│  [自动检测 ▼]  →  [中文 ▼]       │
│                                  │
│  ┌──────────────────────────┐    │
│  │ Enter text...            │    │
│  │                          │    │
│  └──────────────────────────┘    │
│                                  │
│  ┌──────────────────────────┐    │
│  │ 翻译结果...              │    │
│  │                    📋    │    │
│  └──────────────────────────┘    │
│                                  │
│  ── 历史 ─────────────────────   │
│  performance → 性能      14:30  │
│  concurrent → 并发       14:28  │
│  idempotent → 幂等的     13:55  │
│                                  │
└──────────────────────────────────┘
```

**翻译实现：**

- 复用用户配置的 AI 大模型 API（OpenAI 兼容协议），零额外配置
- 通过精心设计的 Prompt 让大模型充当翻译引擎
- 自动检测语言：中文 ↔ 英文智能互译
- 翻译历史保存到 `translations.json`，可搜索复用

---

### 5.5 AI 助手 Tab

```
┌──────────────────────────────────┐
│  📝记录  ✅清单  🌐翻译  🤖AI  ⚙️  │
│──────────────────────────────────│
│                                  │
│  🤖 你好！我可以帮你：            │
│     · 回答问题                   │
│     · 归纳整理你的笔记            │
│     · 生成 TODO 和计划            │
│                                  │
│  👤 帮我总结今天的记录            │
│                                  │
│  🤖 根据你今天的 5 条记录：       │
│     1. React 性能优化...          │
│     2. 产品需求评审...            │
│     ░░░░ (流式输出中...)          │
│                                  │
│                                  │
│                                  │
│──────────────────────────────────│
│  ┌──────────────────────────┐    │
│  │ 输入问题...  [Ctrl+Enter]│    │
│  └──────────────────────────┘    │
└──────────────────────────────────┘
```

**AI 功能：**

| 功能 | 说明 |
|------|------|
| 自由对话 | 流式输出，打字机效果 |
| 笔记归纳 | 选中多条记录 → AI 生成摘要 / TODO |
| 语义搜索 | 用自然语言描述想找的内容，AI 从记录中匹配 |
| 上下文感知 | 可以引用当前工作区的笔记作为上下文 |

**OpenAI 兼容协议配置（存储在 config.json）：**

```json
{
  "ai": {
    "apiBase": "https://api.openai.com/v1",
    "apiKey": "<AES加密后的密文>",
    "model": "gpt-4o-mini",
    "temperature": 0.7,
    "maxTokens": 2048
  }
}
```

**流式响应 & 重试：** 请求失败后指数退避重试（2s → 5s → 10s → 提示用户）

---

### 5.6 设置 Tab

```
┌──────────────────────────────────┐
│  📝记录  ✅清单  🌐翻译  🤖AI  ⚙️  │
│──────────────────────────────────│
│                                  │
│  ▸ 存储                          │
│    数据目录:                      │
│    D:\MyNotes\QuickStart [更改]   │
│    [✓] 每日自动备份 (保留7份)      │
│                                  │
│  ▸ AI 服务                       │
│    API 地址:                      │
│    https://api.openai.com/v1     │
│    API Key: sk-****     [修改]    │
│    模型: gpt-4o-mini      [▼]    │
│                                  │
│  ▸ 外观                          │
│    [◉ 亮色] [○ 暗色] [○ 系统]    │
│                                  │
│  ▸ 快捷键                        │
│    唤起窗口: Ctrl+Shift+Q   [修改]   │
│                                  │
│  ▸ 窗口                          │
│    [✓] 置顶显示                   │
│    [  ] 点击外部时隐藏             │
│    [✓] 开机自启动                 │
│                                  │
│  ▸ 工作区                        │
│    [默认] [工作] [学习]   [+]     │
│                                  │
│  ▸ 数据                          │
│    [导出全部]  [导入]             │
│                                  │
└──────────────────────────────────┘
```

---

## 六、数据安全

| 安全项 | 方案 |
|--------|------|
| API Key 存储 | 使用 Web Crypto API (AES-GCM) 加密后存入 config.json |
| 数据存储 | 全部本地文件，零云端上传 |
| 误删保护 | 软删除 + 30 秒 Undo Toast |
| 自动备份 | 每日将数据目录复制到 backups/，保留最近 7 份 |
| 导出 | 笔记本身就是 .md 文件，无需转换；清单可导出为 JSON/Markdown |
| 存储路径可选 | 用户可自由选择数据存储目录，或使用默认 %APPDATA% 路径 |

---

## 七、UI/UX 设计方向

### 7.1 视觉风格

- **设计语言：** 简洁扁平 + 细线分隔，类似 Arc 浏览器侧边栏 / Notion 侧栏
- **主题：** 亮色 / 暗色 / 跟随系统
- **字体：** 系统默认 UI 字体 + 等宽字体（代码块）
- **间距：** 紧凑但不拥挤，充分利用 380px 宽度

### 7.2 微交互

- **保存成功** — 按钮短暂变绿 + ✓ 动画
- **AI 响应中** — 骨架屏 + 打字机效果
- **Tab 切换** — 内容区域左右滑动过渡
- **清单勾选** — 勾选时 checkbox 弹跳动画 + 文字淡化划线
- **里程碑** — 第 10/50/100/500 条记录触发 Canvas 彩带动画
- **删除** — 底部 Toast："已删除，撤销"（30 秒倒计时）
- **侧边栏唤起** — 从右侧滑入，200ms ease-out

### 7.3 统计信息

轻量统计条，显示在记录 Tab 底部：

```
📊 今日:5  累计:328  🔥连续7天
```

---

## 八、项目结构

```
QuickStart/
├── electron/                     # Electron 主进程
│   ├── main.ts                   # 主入口 (窗口创建、托盘、热键)
│   ├── preload.ts                # 预加载脚本 (安全暴露 API)
│   ├── ipc/                      # IPC 处理器
│   │   ├── fileHandlers.ts       # 文件读写操作
│   │   ├── todoHandlers.ts       # 清单文件读写
│   │   ├── configHandlers.ts     # 配置管理
│   │   ├── dialogHandlers.ts     # 系统对话框 (选择目录等)
│   │   └── windowHandlers.ts     # 窗口控制
│   ├── services/                 # 主进程服务
│   │   ├── fileStorage.ts        # 文件存储逻辑
│   │   ├── backup.ts             # 自动备份
│   │   ├── crypto.ts             # API Key 加密/解密
│   │   ├── imageProcessor.ts     # 图片压缩处理
│   │   └── notification.ts       # 系统通知 (清单提醒)
│   └── utils/
│       └── paths.ts              # 路径工具
│
├── src/                          # React 渲染进程
│   ├── components/
│   │   ├── Layout/               # 布局
│   │   │   ├── Sidebar.tsx       # 侧边栏容器 (380px)
│   │   │   ├── TabBar.tsx        # Tab 导航栏 (图标模式)
│   │   │   ├── TitleBar.tsx      # 自定义标题栏 (拖拽 + 关闭)
│   │   │   └── StatusBar.tsx     # 底部统计栏
│   │   ├── Notes/                # 记录 Tab
│   │   │   ├── NoteEditor.tsx    # Markdown 编辑器
│   │   │   ├── NoteList.tsx      # 记录列表 (虚拟滚动)
│   │   │   ├── NoteItem.tsx      # 单条记录卡片
│   │   │   ├── SearchBar.tsx     # 搜索框
│   │   │   └── WorkspaceSelector.tsx
│   │   ├── Todo/                 # 清单 Tab (新增)
│   │   │   ├── TodoPanel.tsx     # 清单主面板
│   │   │   ├── TodoItem.tsx      # 单条清单项 (勾选/编辑/颜色)
│   │   │   ├── TodoInput.tsx     # 底部添加输入框
│   │   │   ├── TodoToolbar.tsx   # 底部工具栏 (颜色/提醒/删除)
│   │   │   ├── DateNavigator.tsx # 顶部日期导航 (◀ 日期 ▶)
│   │   │   └── DatePicker.tsx    # 日期选择弹出层
│   │   ├── Translator/           # 翻译 Tab
│   │   │   ├── TranslatePanel.tsx
│   │   │   └── TranslateHistory.tsx
│   │   ├── AI/                   # AI 助手 Tab
│   │   │   ├── ChatPanel.tsx
│   │   │   ├── MessageBubble.tsx
│   │   │   └── StreamRenderer.tsx
│   │   ├── Settings/             # 设置 Tab
│   │   │   ├── StorageSettings.tsx
│   │   │   ├── AISettings.tsx
│   │   │   ├── AppearanceSettings.tsx
│   │   │   ├── WindowSettings.tsx   # 窗口行为设置 (新增)
│   │   │   └── ShortcutSettings.tsx
│   │   └── ui/                   # 通用 UI 组件
│   │       ├── Button.tsx
│   │       ├── Input.tsx
│   │       ├── Toast.tsx
│   │       ├── Checkbox.tsx      # 带动画的勾选框
│   │       ├── ColorPicker.tsx   # 颜色选择器
│   │       ├── Dialog.tsx
│   │       └── Skeleton.tsx
│   ├── stores/                   # Zustand 状态管理
│   │   ├── noteStore.ts
│   │   ├── todoStore.ts          # 清单状态 (新增)
│   │   ├── settingsStore.ts
│   │   ├── workspaceStore.ts
│   │   ├── translateStore.ts
│   │   └── aiStore.ts
│   ├── hooks/
│   │   ├── useAutoSave.ts
│   │   ├── useShortcuts.ts
│   │   ├── useTodoActions.ts     # 清单操作 Hook (新增)
│   │   └── useTheme.ts
│   ├── utils/
│   │   ├── dateFormat.ts
│   │   ├── markdown.ts
│   │   └── search.ts
│   ├── styles/
│   │   └── globals.css
│   ├── App.tsx
│   └── main.tsx
│
├── resources/
│   └── icon.png
│
├── package.json
├── tsconfig.json
├── electron-builder.yml
├── electron.vite.config.ts
├── tailwind.config.js
└── README.md
```

---

## 九、IPC 通信设计

所有文件操作通过 IPC 通信，渲染进程不直接访问 Node.js：

```typescript
// 渲染进程可用的 API (通过 contextBridge 暴露)
interface QuickStartAPI {
  // 笔记
  notes: {
    save(workspaceId: string, note: NoteData): Promise<string>
    load(workspaceId: string, noteId: string): Promise<string>
    list(workspaceId: string): Promise<NoteMeta[]>
    delete(workspaceId: string, noteId: string): Promise<void>
    search(workspaceId: string, query: string): Promise<NoteMeta[]>
  }
  // 每日清单 (新增)
  todos: {
    load(date: string): Promise<TodoDay>             // 加载某天清单
    save(date: string, data: TodoDay): Promise<void>  // 保存某天清单
    listDates(): Promise<string[]>                    // 列出有清单的日期
  }
  // 工作区
  workspaces: {
    list(): Promise<Workspace[]>
    create(name: string): Promise<Workspace>
    delete(id: string): Promise<void>
  }
  // 配置
  config: {
    get(): Promise<AppConfig>
    set(config: Partial<AppConfig>): Promise<void>
    selectDataDir(): Promise<string | null>
  }
  // AI
  ai: {
    chat(messages: Message[], onChunk: (text: string) => void): Promise<void>
    abort(): void
  }
  // 附件
  attachments: {
    saveImage(workspaceId: string, buffer: ArrayBuffer): Promise<string>
  }
  // 窗口
  window: {
    hide(): void
    minimize(): void
    togglePin(): void  // 切换置顶
  }
  // 系统通知 (清单提醒)
  notification: {
    schedule(id: string, title: string, time: string): Promise<void>
    cancel(id: string): Promise<void>
  }
}
```

---

## 十、开发路线图

### Phase 1 — MVP 核心体验 (v0.1)

> 目标：跑通「热键唤起侧边栏 → 快速记录 / 每日清单 → 保存到本地」

- [ ] Electron 项目初始化 (electron-vite + React + TypeScript)
- [ ] 侧边栏窗口 (380px, 贴右侧, 滑入动画)
- [ ] 自定义无边框标题栏
- [ ] 全局热键唤起 (`Ctrl+Shift+Q`)
- [ ] 系统托盘常驻 (双击打开、右键菜单)
- [ ] Tab 导航栏 (图标模式, 5 个 Tab)
- [ ] 记录 Tab：输入框 + `Ctrl+Enter` 保存 + 列表
- [ ] 清单 Tab：日期导航 + 添加事项 + 勾选完成 + 颜色设置
- [ ] 文件存储：JSON + Markdown 本地文件
- [ ] 亮色/暗色主题切换

### Phase 2 — 功能完善 (v0.2)

- [ ] Markdown 实时预览编辑器
- [ ] 翻译 Tab (AI API 驱动，翻译历史)
- [ ] AI 助手 Tab (流式对话输出)
- [ ] 设置 Tab (API 配置、存储路径选择、窗口行为)
- [ ] 工作区管理 (创建/切换/删除)
- [ ] 图片粘贴 & WebP 压缩
- [ ] 全文搜索
- [ ] 清单提醒 (系统通知)

### Phase 3 — 智能化 (v0.3)

- [ ] AI 笔记归纳 & TODO 生成
- [ ] 语义搜索
- [ ] 自然语言日期识别
- [ ] 分享卡片生成 (Canvas 渲染)
- [ ] 统计看板 & 里程碑彩带动画

### Phase 4 — 打磨发布 (v1.0)

- [ ] 虚拟滚动优化 (万级数据)
- [ ] 自动备份 & 恢复
- [ ] 清单拖拽排序
- [ ] electron-builder 打包 exe + 安装程序
- [ ] 自动更新 (electron-updater)
- [ ] 开机自启动

---

## 十一、关于"纯前端"方案的补充说明

Electron 应用分为**主进程**和**渲染进程**，但两者都用 TypeScript 编写：

```
┌──────────────────────────────┐
│  渲染进程 = 纯前端 UI 代码     │  ← React, 你熟悉的前端
│  (浏览器环境，无 Node.js)      │
├──────────────────────────────┤
│  主进程 = "薄薄的一层胶水"      │  ← 也是 TypeScript！
│  (Node.js 环境，处理文件/系统)  │     只负责文件读写、系统API调用
├──────────────────────────────┤
│  preload = 安全桥梁            │  ← 定义渲染进程可用的 API
└──────────────────────────────┘
```

- 主进程只做**最薄的文件 I/O 和系统调用**，不含业务逻辑
- 所有业务逻辑、数据处理、UI 渲染都在渲染进程（纯前端）完成
- 不存在传统意义上的"后端服务器"，不监听任何端口

---

## 十二、健壮性 & 边界情况处理

### 12.1 单实例锁

防止用户多次双击 exe 启动多个实例，导致文件写入冲突：

```typescript
const gotLock = app.requestSingleInstanceLock()
if (!gotLock) {
  app.quit()
} else {
  app.on('second-instance', () => {
    mainWindow.show()
  })
}
```

### 12.2 文件操作容错

采用「写临时文件 → 原子重命名」策略，防止写入中断导致 JSON 损坏：

```
写入: data → .tmp → 校验 → 原文件重命名为 .bak → .tmp 重命名为正式文件
恢复: 正常 → .bak 回退 → backups 恢复 → 初始化空数据
```

### 12.3 索引文件分片

笔记 index.json 超过 500 条时，自动按年月归档到 `archive/` 目录。

### 12.4 数据版本管理

`config.json` 中记录 `schemaVersion`，应用升级时自动执行迁移脚本链。

### 12.5 其他边界情况

| 情况 | 处理方式 |
|------|---------|
| 磁盘空间不足 | 写入前检测，不足时 Toast 警告 |
| 存储目录被删除 | 启动时检测，弹窗要求重新选择 |
| 附件体积过大 | 图片压缩为 WebP，单张限制 5MB |
| JSON 解析失败 | 自动回退到 .bak |
| AI API 超时 | 30 秒超时 + 指数退避重试 |

---

## 十三、日志 & 调试

使用 `electron-log`，日志写入 `%APPDATA%/QuickStart/logs/`：

- 生产环境默认 `info` 级别，可开启 `debug`
- 日志按大小轮转（5MB，保留 3 份）
- 不上传任何数据到远端
- 设置页提供「复制错误日志」按钮

---

## 十四、性能优化策略

| 环节 | 策略 | 目标 |
|------|------|------|
| 窗口唤起 | 隐藏而非销毁，唤起时 `show()` + 滑入动画 | < 200ms |
| 首次加载 | Tab 内容懒加载 | < 1s 首屏 |
| 笔记列表 | TanStack Virtual 虚拟滚动 | 万级流畅 |
| 清单加载 | 每天独立 JSON，切换日期仅加载一个小文件 | < 50ms |
| 文件写入 | 防抖 2s + 异步写入 | 输入无卡顿 |
| AI 流式 | ReadableStream 逐 token 渲染 | 首 token < 1s |
| 打包体积 | electron-builder + asar + 排除开发依赖 | < 100MB |

---

## 十五、测试策略

| 层级 | 工具 | 覆盖范围 |
|------|------|---------|
| 单元测试 | Vitest | 工具函数、Store、数据处理 |
| 组件测试 | Vitest + Testing Library | React 组件渲染与交互 |
| E2E 测试 | Playwright + electron | 完整用户流程 |

---

## 十六、待讨论的问题

1. **热键方案** — `Ctrl+Shift+Q` 作为唤起快捷键，避免了 `Alt+Space` 与 Windows 系统菜单的冲突。
2. **翻译引擎** — 是否需要在 AI API 之外，额外集成免费翻译 API 作为开箱体验？
3. **多设备同步** — v1 纯本地，后续是否考虑网盘同步？
4. **开机自启** — 是否默认开机自启并常驻托盘？
5. **侧边栏方向** — 默认贴右侧，是否需要支持贴左侧？

---

*文档版本：v0.4 | 最后更新：2026-02-08*
